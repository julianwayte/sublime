name: "Spam: Online gambling promotion from untrusted sender"
description: |
  Detects inbound messages promoting online gambling, casinos, or betting from
  untrusted senders. These emails typically use subject lines referencing free spins,
  no deposit bonuses, jackpots, or similar gambling enticements. When links are
  present, the rule also checks for free file host abuse (Google Cloud Storage,
  Firebase, etc.). Many gambling spam emails use unusual MIME types or obfuscation
  that prevent body parsing, so the rule primarily relies on subject-line signals
  combined with sender reputation.
type: "rule"
severity: "medium"
source: |
  type.inbound

  // subject or body contains gambling-related language
  and (
    regex.icontains(subject.subject,
                    'free spin',
                    'casino',
                    'jackpot',
                    'no deposit',
                    'slot(s| machine)',
                    'play for free',
                    'win for real',
                    'online (poker|gambling|betting)',
                    'bonus.*spins'
    )
    or regex.icontains(body.current_thread.text,
                       'free spin',
                       'casino bonus',
                       'no deposit required',
                       'play for free',
                       'win for real',
                       'jackpot',
                       'slot machine',
                       'sign up.*bonus.*spin'
    )
  )

  // sender is not a trusted domain
  and sender.email.domain.root_domain not in $high_trust_sender_root_domains

  // if links exist, optionally check for free file host abuse
  and (
    length(body.links) == 0
    or any(body.links,
           .href_url.domain.domain in $free_file_hosts
           or .href_url.domain.root_domain in $free_file_hosts
           or .href_url.domain.root_domain in $free_subdomain_hosts
    )
    or sender.email.domain.tld in $suspicious_tlds
  )
attack_types:
  - "Spam"
tactics_and_techniques:
  - "Free file host"
  - "Social engineering"
detection_methods:
  - "Content analysis"
  - "Sender analysis"
  - "URL analysis"
