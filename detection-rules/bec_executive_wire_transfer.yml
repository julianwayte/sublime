name: "BEC: Executive impersonation with wire transfer request"
description: |
  Detects messages impersonating executives via display name spoofing (matching names in
  $org_display_names) combined with NLU-detected wire transfer or payment urgency intent,
  from new or outlier senders. This targets Business Email Compromise (BEC) fraud where
  attackers impersonate C-suite or senior leadership to request fraudulent wire transfers
  or payment changes.
type: "rule"
severity: "high"
source: |
  type.inbound

  // sender display name matches a known org display name
  and (
    sender.display_name in $org_display_names
    or any($org_display_names,
           strings.ilevenshtein(sender.display_name, .) < 3
           and sender.display_name != ""
    )
  )

  // but sender email domain is NOT an org domain (display name spoofing)
  and sender.email.domain.domain not in $org_domains

  // NLU classifier detects BEC intent
  and any(ml.nlu_classifier(body.current_thread.text).intents,
          .name == "bec" and .confidence in ("medium", "high")
  )

  // body contains wire transfer or payment urgency language
  and (
    regex.icontains(body.current_thread.text,
                    'wire\s+transfer',
                    'bank\s+transfer',
                    'ach\s+transfer',
                    'routing\s+number',
                    'account\s+number',
                    'swift\s+code',
                    'payment.*redirect',
                    'update.*bank.*details',
                    'change.*payment.*account',
                    'new\s+(bank|payment|vendor)\s+(account|details|information)',
                    'send\s+(the\s+)?funds',
                    'process\s+(the\s+)?(payment|transfer|wire)',
                    'urgent\s+(payment|transfer|wire)',
                    'confidential.*transfer',
                    'do\s+not\s+(discuss|share|mention)',
                    'keep\s+this\s+(between|confidential|quiet)',
                    'time.?sensitive'
    )
  )

  // sender profile: new or outlier, not solicited
  and (
    (
      profile.by_sender().prevalence in ("new", "outlier")
      and not profile.by_sender().solicited
    )
    or (
      profile.by_sender().any_messages_malicious_or_spam
      and not profile.by_sender().any_messages_benign
    )
  )
  and not profile.by_sender().any_messages_benign

  // negate highly trusted sender domains unless they fail DMARC authentication
  and (
    (
      sender.email.domain.root_domain in $high_trust_sender_root_domains
      and not headers.auth_summary.dmarc.pass
    )
    or sender.email.domain.root_domain not in $high_trust_sender_root_domains
  )
attack_types:
  - "BEC/Fraud"
tactics_and_techniques:
  - "Impersonation: Employee"
  - "Social engineering"
detection_methods:
  - "Content analysis"
  - "Header analysis"
  - "Natural Language Understanding"
  - "Sender analysis"
id: "a1b2c3d4-0004-4000-8000-becwiretransfer"
