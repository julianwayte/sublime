name: "Test: PDF attachment with OCR-detected canary watermark"
description: |
  Test rule that triggers when an inbound email has a PDF attachment and Sublime's OCR
  engine extracts the canary phrase "SUBLIME-SCAN-WATERMARK-4K2P" from the PDF content.
  This rule tests the file.explode() and OCR scanning pipeline. Attach a PDF containing
  the watermark text to verify file analysis rules are evaluating correctly.
type: "rule"
severity: "low"
source: |
  type.inbound
  and any(attachments,
          (.file_type == "pdf" or .file_extension == "pdf")
          and any(file.explode(.),
                  strings.icontains(.scan.ocr.raw, 'SUBLIME-SCAN-WATERMARK-4K2P')
                  or strings.icontains(.scan.strings.raw, 'SUBLIME-SCAN-WATERMARK-4K2P')
          )
  )
attack_types:
  - "Malware/Ransomware"
tactics_and_techniques:
  - "Social engineering"
detection_methods:
  - "Content analysis"
  - "File analysis"
  - "Optical Character Recognition"
id: "a1b2c3d4-0011-4000-8000-pdfocrwatermark"
